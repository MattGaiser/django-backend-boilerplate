services:
  db:
    env_file:
      - .env.test
    volumes: 
      - type: tmpfs
        target: /var/lib/postgresql/data

  django:
    env_file:
      - .env.test
    environment:
      - DEBUG=false
    command: >
      sh -c "pip install --user --no-cache-dir --trusted-host pypi.org --trusted-host pypi.python.org --trusted-host files.pythonhosted.org -r requirements.txt &&
             python manage.py migrate &&
             python manage.py test --keepdb"

  prefect-server:
    env_file:
      - .env.test
    environment:
      PREFECT_SERVER_API_HOST: 0.0.0.0
      PREFECT_UI_ENABLED: false
    ports: []

  prefect-agent:
    env_file:
      - .env.test
    command: echo "Prefect agent disabled in test environment"
